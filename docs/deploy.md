<img src="images/koncierge-logo.svg" alt="Koncierge" style="float: right; margin-right: 10px; margin-left: 10px;  height: 150px" />

# Deploy to Kubernetes

## Step 1: Prepare Kubernetes

See [Prepare Kubernetes](prepare-k8s.md).

## Step 2: Deploy to a cluster

Navigate to where the YAML files are that were generated by Koncienge, e.g.

```shell
$ cd examples/example2/
$ ls
README.md	config		docs		output		pom.xml		src		target
$ cd output/
$ ls -l
total 80
-rw-r--r--  1 user  wheel  5272 Oct 21 00:15 Kubernetes-Manifests-DEV.yaml
-rw-r--r--  1 user  wheel  5272 Oct 21 00:15 Kubernetes-Manifests-INT.yaml
-rw-r--r--  1 user  wheel  5212 Oct 21 00:15 Kubernetes-Manifests-LOCAL.yaml
-rw-r--r--  1 user  wheel  5275 Oct 21 00:15 Kubernetes-Manifests-PERF.yaml
-rw-r--r--  1 user  wheel  5833 Oct 21 00:15 Kubernetes-Manifests-PROD.yaml
```

Find and create the namespace(s) needed for the deployment:

```shell
$ cat Kubernetes-Manifests-LOCAL.yaml | grep 'namespace'
  namespace: to-do
  namespace: to-do
  namespace: to-do
  namespace: to-do
  namespace: to-do
  namespace: to-do
  namespace: to-do
  namespace: to-do
  namespace: to-do
  namespace: to-do
  namespace: to-do
  namespace: to-do
  namespace: to-do
  namespace: to-do
  namespace: to-do
$ kubectl create namespace to-do
namespace/to-do created
```

Deploy the YAML configuration file for the applicable environment to Kubernetes. 
For example, for your local environment:

```shell
$ kubectl apply -f Kubernetes-Manifests-LOCAL.yaml 
secret/backend created
configmap/backend created
deployment.apps/backend created
service/backend created
configmap/frontend created
deployment.apps/frontend created
service/frontend created
secret/database created
configmap/database created
deployment.apps/database created
service/database created
persistentvolume/database-pv created
persistentvolumeclaim/database-pvc created
storageclass.storage.k8s.io/to-do-data created
ingress.networking.k8s.io/to-do created
```

## Step 3: Check that it has deployed correctly

Start K9s:

```shell
$ k9s
```

Press "0" to see all the pods. You should see something like this:

![example2_k9s_showing_pods.png](images%2Fexample2_k9s_showing_pods.png)

If you are seeing something other that pods, type `:pods`.

If some of the pods not yet have status "Running", wait a bit.

If the problem persists, use the arrow keys to select the pod and then press the "d" key
to see a description of what is going on with the pod. 

See https://k9scli.io/topics/commands/ for all the commands you can use with K9s.

Type `:storageclass` to check the storage:

![example2_k9s_showing_storageclass.png](images%2Fexample2_k9s_showing_storageclass.png)

Type `:pv` to check that the persistent volume(s) have status "Bound":

![example2_k9s_showing_pv.png](images%2Fexample2_k9s_showing_pv.png)

Type `:pvc` and type "0" to check that the persistent volume claim(s) have status "Bound":

![example2_k9s_showing_pvc.png](images%2Fexample2_k9s_showing_pvc.png)

Type `:secrets` to see the secrets:

![example2_k9s_showing_secrets.png](images%2Fexample2_k9s_showing_secrets.png)

Select one and type "x" to decode the secret. 

Type `:configmaps` to see the config maps:

![example2_k9s_showing_configmaps.png](images%2Fexample2_k9s_showing_configmaps.png)

Select one and type "d" to see the data in the map.

Type `:service` to see the services:

![example2_k9s_showing_services.png](images%2Fexample2_k9s_showing_services.png)

Type `:deployment` to see the deployments:

![example2_k9s_showing_deployments.png](images%2Fexample2_k9s_showing_deployments.png)

Type `:ingress` to see the ingresses:

![example2_k9s_showing_ingresses.png](images%2Fexample2_k9s_showing_ingresses.png)

Type `:pods` to go back to viewing the pods.